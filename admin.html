<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Scroll Verse Arena</title>
  <link href="style.css" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <h1 class="title">üéÆ Admin - Scroll Verse Arena</h1>

    <div>
      <label>Mot de passe admin :</label><br />
      <input type="password" id="adminPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      <button onclick="login()">Se connecter</button>
   <h3>üèÜ Classement des joueurs</h3>
<table id="scoreTable" border="1" style="margin: auto;">
  <thead>
    <tr><th>Pseudo</th><th>Score</th><th>+1</th><th>R√©initialiser</th></tr>
  </thead>
  <tbody id="scoreBody"></tbody>
</table> 
      
    </div>

    <div id="adminPanel" style="display:none; margin-top:2rem;">
      <h3>üõ†Ô∏è Modifier les questions existantes</h3>
<div id="questionEditor"></div>
      <h3>üéÆ Lancer un Round</h3>
<div id="roundsList"></div>
      <h2>Cr√©er une question</h2>
      <select id="questionType">
        <option value="qcm">QCM</option>
        <option value="image">QCM avec image</option>
        <option value="libre">R√©ponse libre</option>
      </select><br /><br />

      <input type="text" id="questionText" placeholder="Texte de la question" /><br /><br />
      <input type="text" id="options" placeholder="Options s√©par√©es par virgule (si QCM)" /><br /><br />
      <input type="text" id="answer" placeholder="Bonne(s) r√©ponse(s)" /><br /><br />
      <input type="text" id="imageURL" placeholder="URL de l‚Äôimage (si image)" /><br /><br />
      <button onclick="addQuestion()">‚ûï Ajouter la question</button>

      <h3>üìã Questions en m√©moire :</h3>
      <ul id="questionList"></ul>

      <h3>‚öîÔ∏è Contr√¥le de la partie :</h3>
      <button onclick="launchRound()">‚ñ∂Ô∏è Lancer le round</button>
      <button onclick="resetGame()">‚ôªÔ∏è R√©initialiser les joueurs</button>
   
      <h3>üì® R√©ponses des joueurs</h3>
<div id="responsesList" style="text-align:left;"></div>
<button onclick="refreshResponses()">üîÑ Actualiser</button>
    </div>
    <h3>üìã Corriger manuellement</h3>
<label for="questionToCorrect">Question #</label>
<input type="number" id="questionToCorrect" min="1" />
<button onclick="showManualCorrection()">Afficher r√©ponses</button>
<div id="manualCorrectionArea"></div>
  </div>

  
  <script>
    let isAdmin = false;
    let questions = [];

    function login() {
      const pass = document.getElementById('adminPass').value;
      if (pass === 'arena2024') {
        isAdmin = true;
        document.getElementById('adminPanel').style.display = 'block';
        alert('Acc√®s admin valid√©');
      } else {
        alert('Mot de passe incorrect');
      }
    }

    function addQuestion() {
      const type = document.getElementById('questionType').value;
      const text = document.getElementById('questionText').value;
      const options = document.getElementById('options').value.split(',');
      const answer = document.getElementById('answer').value.split(',');
      const image = document.getElementById('imageURL').value;

      const q = { type, text, options, answer, image };
      questions.push(q);

      const li = document.createElement('li');
      li.innerText = `${type.toUpperCase()} : ${text}`;
      document.getElementById('questionList').appendChild(li);
    }

    function launchRound() {
      alert('Round lanc√© ! Les joueurs verront la prochaine question.');
    }

    function resetGame() {
      localStorage.clear();
      alert('Tous les joueurs ont √©t√© r√©initialis√©s.');
    }
    let scores = JSON.parse(localStorage.getItem("scores") || "{}");

function updateScoreTable() {
  const tbody = document.getElementById("scoreBody");
  tbody.innerHTML = "";
  for (const [pseudo, score] of Object.entries(scores)) {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${pseudo}</td>
      <td>${score}</td>
      <td><button onclick="addPoint('${pseudo}')">+1</button></td>
      <td><button onclick="resetPlayer('${pseudo}')">‚ùå</button></td>
    `;
    tbody.appendChild(row);
  }
  localStorage.setItem("scores", JSON.stringify(scores));
}

function addPoint(pseudo) {
  scores[pseudo] = (scores[pseudo] || 0) + 1;
  updateScoreTable();
}

function resetPlayer(pseudo) {
  delete scores[pseudo];
  updateScoreTable();
}

document.addEventListener("DOMContentLoaded", updateScoreTable);
  function refreshResponses() {
  const container = document.getElementById("responsesList");
  const responses = JSON.parse(localStorage.getItem("responses") || "[]");
  if (responses.length === 0) {
    container.innerHTML = "<p>Aucune r√©ponse enregistr√©e.</p>";
    return;
  }

  container.innerHTML = responses.map(r => `
    <div style="margin-bottom:1rem; border-bottom:1px solid #ccc; padding-bottom:0.5rem;">
      <strong>${r.player}</strong><br/>
      <em>Q:</em> ${r.question}<br/>
      <em>R:</em> ${r.answer}<br/>
      <button onclick="addPoint('${r.player}')">+1 point</button>
    </div>
  `).join("");
    }
    function renderRounds() {
  const container = document.getElementById("roundsList");
  container.innerHTML = "";
  for (let i = 0; i <  questions.length; i++) {
    const btn = document.createElement("button");
    btn.innerText = `Round ${i + 1}`;
    btn.onclick = () => {
      localStorage.setItem("startRound", i);
      alert(`Round ${i + 1} lanc√© !`);
    };
    container.appendChild(btn);
  }
}

renderRounds();
    function showManualCorrection() {
  const qNum = parseInt(document.getElementById("questionToCorrect").value) - 1;
  if (isNaN(qNum) || qNum < 0 || qNum >= questions.length) {
    alert("Num√©ro de question invalide.");
    return;
  }

  const manualZone = document.getElementById("manualCorrectionArea");
  const responses = JSON.parse(localStorage.getItem("responses") || "[]");
  const filtered = responses.filter(r => r.question === questions[qNum].text);

  if (filtered.length === 0) {
    manualZone.innerHTML = "<p>Aucune r√©ponse trouv√©e pour cette question.</p>";
    return;
  }

  let html = "<ul>";
  filtered.forEach((r, i) => {
    html += `
      <li>
        <strong>${r.player} :</strong> ${r.answer}
        <button onclick="giveManualPoint('${r.player}')">Donner 1 point</button>
      </li>
    `;
  });
  html += "</ul>";
  manualZone.innerHTML = html;
}

function giveManualPoint(player) {
  const scores = JSON.parse(localStorage.getItem("scores") || "{}");
  scores[player] = (scores[player] || 0) + 1;
  localStorage.setItem("scores", JSON.stringify(scores));
  alert(`+1 point pour ${player}`);
                        }
    function renderQuestionEditor() {
  const container = document.getElementById("questionEditor");
  container.innerHTML = "";

  questions.forEach((q, index) => {
    const wrapper = document.createElement("div");
    wrapper.style.border = "1px solid #ccc";
    wrapper.style.padding = "10px";
    wrapper.style.marginBottom = "10px";

    wrapper.innerHTML = `
      <strong>Question ${index + 1}</strong><br>
      <label>Texte :</label><br>
      <textarea id="qText${index}" rows="2" style="width:100%;">${q.text}</textarea><br>

      <label>Type :</label>
      <select id="qType${index}">
        <option value="qcm" ${q.type === "qcm" ? "selected" : ""}>QCM</option>
        <option value="libre" ${q.type === "libre" ? "selected" : ""}>R√©ponse libre</option>
        <option value="image" ${q.type === "image" ? "selected" : ""}>Image</option>
      </select><br>

      <label>Image URL (optionnelle) :</label><br>
      <input type="text" id="qImage${index}" style="width:100%;" value="${q.image || ""}"><br>

      <label>Options (s√©par√©es par des virgules) :</label><br>
      <input type="text" id="qOptions${index}" style="width:100%;" value="${(q.options || []).join(",")}"><br>

      <label>Bonne(s) r√©ponse(s) (s√©par√©es par des virgules) :</label><br>
      <input type="text" id="qAnswer${index}" style="width:100%;" value="${(q.answer || []).join(",")}"><br>

      <button onclick="saveEditedQuestion(${index})">üíæ Enregistrer</button>
      <button onclick="deleteQuestion(${index})" style="color:red;">üóë Supprimer</button>
    `;

    container.appendChild(wrapper);
  });
}

function saveEditedQuestion(index) {
  questions[index].text = document.getElementById(`qText${index}`).value;
  questions[index].type = document.getElementById(`qType${index}`).value;
  questions[index].image = document.getElementById(`qImage${index}`).value;
  questions[index].options = document.getElementById(`qOptions${index}`).value.split(",").map(opt => opt.trim());
  questions[index].answer = document.getElementById(`qAnswer${index}`).value.split(",").map(ans => ans.trim());

  localStorage.setItem("questions", JSON.stringify(questions));
  alert("Question mise √† jour !");
  renderQuestionEditor();
  renderRounds(); // met √† jour les boutons de round aussi
}

function deleteQuestion(index) {
  if (confirm("Supprimer cette question ?")) {
    questions.splice(index, 1);
    localStorage.setItem("questions", JSON.stringify(questions));
    alert("Question supprim√©e.");
    renderQuestionEditor();
    renderRounds();
  }
    }
  </script>
</body>
</html>
